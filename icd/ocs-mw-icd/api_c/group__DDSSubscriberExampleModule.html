<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RTI Data Distribution Service C API: Subscriber Use Cases</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>Subscriber Use Cases<br>
<small>
[<a class="el" href="group__DDSHowToModule.html">Programming How-To's</a>]</small>
</h1>Working with subscribers.  
<a href="#_details">More...</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
</table>
<h2><a class="anchor" name="DDSSubscriberExampleModule_subscriber_setup">
Setting up a subscriber</a></h2>
<ul>
<li><a class="el" href="group__DDSParticipantExampleModule.html#DDSParticipantExampleModule_setup">Set up participant</a></li></ul>
<p>
<ul>
<li>Create a DDS_Subscriber <div class="fragment"><pre class="fragment">    <span class="keyword">struct </span><a class="code" href="structDDS__SubscriberQos.html">DDS_SubscriberQos</a> subscriber_qos = <a class="code" href="group__DDSSubscriberModule.html#ga25">DDS_SubscriberQos_INITIALIZER</a>;
    <a class="code" href="group__DDSSubscriberModule.html#ga0">DDS_Subscriber</a>* subscriber;
    <span class="keyword">struct </span><a class="code" href="structDDS__SubscriberListener.html">DDS_SubscriberListener</a> subscriber_listener = <a class="code" href="group__DDSSubscriberModule.html#ga26">DDS_SubscriberListener_INITIALIZER</a>;
    <a class="code" href="group__DDSReturnTypesModule.html#ga13">DDS_ReturnCode_t</a> retcode;

    <span class="comment">/* MySubscriberListener_* functions are user defined to match</span>
<span class="comment">       DDS_SubscriberListener functions */</span>
    subscriber_listener.<a class="code" href="structDDS__SubscriberListener.html#o1">on_data_on_readers</a> = 
        MySubscriberListener_DataOnReaders;
    subscriber_listener.<a class="code" href="structDDS__SubscriberListener.html#o0">as_datareaderlistener</a>.<a class="code" href="structDDS__DataReaderListener.html#o1">on_requested_deadline_missed</a> = 
        MySubscriberListener_RequestedDeadlineMissed;
    subscriber_listener.<a class="code" href="structDDS__SubscriberListener.html#o0">as_datareaderlistener</a>.<a class="code" href="structDDS__DataReaderListener.html#o2">on_requested_incompatible_qos</a> = 
        MySubscriberListener_RequestedIncompatibleQos;
    subscriber_listener.<a class="code" href="structDDS__SubscriberListener.html#o0">as_datareaderlistener</a>.<a class="code" href="structDDS__DataReaderListener.html#o3">on_sample_rejected</a> =  
        MySubscriberListener_SampleRejected;
    subscriber_listener.<a class="code" href="structDDS__SubscriberListener.html#o0">as_datareaderlistener</a>.<a class="code" href="structDDS__DataReaderListener.html#o4">on_liveliness_changed</a> =  
        MySubscriberListener_LivelinessChanged;
    subscriber_listener.<a class="code" href="structDDS__SubscriberListener.html#o0">as_datareaderlistener</a>.<a class="code" href="structDDS__DataReaderListener.html#o5">on_data_available</a> =  
        MySubscriberListener_DataAvailable;
    subscriber_listener.<a class="code" href="structDDS__SubscriberListener.html#o0">as_datareaderlistener</a>.<a class="code" href="structDDS__DataReaderListener.html#o6">on_subscription_matched</a> = 
        MySubscriberListener_SubscriptionMatch;
    subscriber_listener.<a class="code" href="structDDS__SubscriberListener.html#o0">as_datareaderlistener</a>.<a class="code" href="structDDS__DataReaderListener.html#o7">on_sample_lost</a> = 
        MySubscriberListener_SampleLost;

    retcode = <a class="code" href="group__DDSDomainParticipantModule.html#ga15">DDS_DomainParticipant_get_default_subscriber_qos</a>(participant, 
                                                     &amp;subscriber_qos);

    <span class="keywordflow">if</span> (retcode != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
        printf(<span class="stringliteral">"***Error: failed to get default subscriber qos\n"</span>);
    }

    subscriber =  <a class="code" href="group__DDSDomainParticipantModule.html#ga23">DDS_DomainParticipant_create_subscriber</a>(participant, 
                                                          &amp;subscriber_qos, 
                                                          &amp;subscriber_listener <span class="comment">/*or NULL*/</span>,
                                                          <a class="code" href="group__DDSStatusTypesModule.html#ga2">DDS_STATUS_MASK_ALL</a>);

    <span class="keywordflow">if</span> (subscriber == NULL) {
        printf(<span class="stringliteral">"***Error: failed to create subscriber\n"</span>);
    }
</pre></div></li></ul>
<h2><a class="anchor" name="DDSSubscriberExampleModule_receive_setup">
Set up subscriber to access received data</a></h2>
<ul>
<li><a class="el" href="group__DDSSubscriberExampleModule.html#DDSSubscriberExampleModule_subscriber_setup">Set up subscriber</a></li></ul>
<p>
<ul>
<li>Set up to handle the DDS_DATA_ON_READERS_STATUS status, in one or both of the following two ways.</li></ul>
<p>
<ul>
<li><a class="el" href="group__DDSEntityExampleModule.html#DDSEntityExampleModule_listener">Enable DDS_DATA_ON_READERS_STATUS for the DDS_SubscriberListener associated with the subscriber</a><ul>
<li>The processing to handle the status change is done in the DDS_SubscriberListener_on_data_on_readers() method of the attached listener.</li><li>Typical processing will <a class="el" href="group__DDSSubscriberExampleModule.html#DDSSubscriberExampleModule_receive">access the received data</a>, either in arbitrary order or in a <a class="el" href="group__DDSSubscriberExampleModule.html#DDSSubscriberExampleModule_receive_ordered">coherent and ordered manner</a>.</li></ul>
</li></ul>
<p>
<ul>
<li><a class="el" href="group__DDSEntityExampleModule.html#DDSEntityExampleModule_statuscondition">Enable DDS_DATA_ON_READERS_STATUS for the DDS_StatusCondition associated with the subscriber</a><ul>
<li>The processing to handle the status change is done <a class="el" href="group__DDSWaitsetExampleModule.html#DDSWaitsetExampleModule_trigger">when the subscriber's attached status condition is triggered</a> and the DDS_DATA_ON_READERS_STATUS status on the subscriber is changed.</li><li>Typical processing will <a class="el" href="group__DDSSubscriberExampleModule.html#DDSSubscriberExampleModule_receive">access the received data</a>, either in an arbitrary order or in a <a class="el" href="group__DDSSubscriberExampleModule.html#DDSSubscriberExampleModule_receive_ordered">coherent and ordered manner</a>.</li></ul>
</li></ul>
<h2><a class="anchor" name="DDSSubscriberExampleModule_receive">
Access received data via a subscriber</a></h2>
<ul>
<li><a class="el" href="group__DDSSubscriberExampleModule.html#DDSSubscriberExampleModule_receive_setup">Ensure subscriber is set up to access received data</a></li></ul>
<p>
<ul>
<li>Get the list of readers that have data samples available: <div class="fragment"><pre class="fragment">    <span class="keyword">struct </span><a class="code" href="structDDS__DataReaderSeq.html">DDS_DataReaderSeq</a> reader_seq = <a class="code" href="group__DDSSequenceModule.html#ga17">DDS_SEQUENCE_INITIALIZER</a>;
    <span class="keywordtype">long</span>                     max_samples = <a class="code" href="group__DDSResourceLimitsQosModule.html#ga1">DDS_LENGTH_UNLIMITED</a>;
    <a class="code" href="group__DDSSampleStateModule.html#ga0">DDS_SampleStateMask</a>      sample_state_mask = <a class="code" href="group__DDSSampleStateModule.html#gga2a50">DDS_NOT_READ_SAMPLE_STATE</a>;
    <a class="code" href="group__DDSViewStateModule.html#ga0">DDS_ViewStateMask</a>        view_state_mask = <a class="code" href="group__DDSViewStateModule.html#ga1">DDS_ANY_VIEW_STATE</a>;
    <a class="code" href="group__DDSInstanceStateModule.html#ga0">DDS_InstanceStateMask</a>    instance_state_mask = <a class="code" href="group__DDSInstanceStateModule.html#ga1">DDS_ANY_INSTANCE_STATE</a>;

    <a class="code" href="group__DDSReturnTypesModule.html#ga13">DDS_ReturnCode_t</a> retcode = <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>;  

    retcode = <a class="code" href="group__DDSSubscriberModule.html#ga16">DDS_Subscriber_get_datareaders</a>(subscriber,
                                             &amp;reader_seq, 
                                             max_samples,
                                             sample_state_mask,
                                             view_state_mask, 
                                             instance_state_mask);


    <span class="keywordflow">if</span> (retcode != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
           printf(<span class="stringliteral">"***Error: failed to access received data via subscriber\n"</span>);
           <span class="keywordflow">return</span>;
    }
</pre></div></li></ul>
<p>
<ul>
<li>Upon successfully getting the list of readers with data, process the data readers to either:<ul>
<li><a class="el" href="group__DDSReaderExampleModule.html#DDSReaderExampleModule_reader_read">Read the data in each reader</a>, <b>OR</b> </li><li><a class="el" href="group__DDSReaderExampleModule.html#DDSReaderExampleModule_reader_take">Take the data in each reader</a></li></ul>
If the intent is to access the data <a class="el" href="group__DDSSubscriberExampleModule.html#DDSSubscriberExampleModule_receive_ordered">coherently or in order</a>, the list of data readers <em>must</em> be processed in the order returned: <div class="fragment"><pre class="fragment">    <span class="keywordtype">int</span> i;
    <span class="keywordflow">for</span>(i = 0; i &lt; DDS_DataReaderSeq_get_length(&amp;reader_seq); ++i) {
      
      TDataReader* reader = DDS_DataReaderSeq_get_reference(&amp;reader_seq, i);

      <span class="comment">/* Take the data from reader, </span>
<span class="comment">                    OR</span>
<span class="comment">         Read the data from reader  */</span>
    }
</pre></div></li></ul>
<p>
<ul>
<li><b>Alternatively</b>, call <a class="el" href="group__DDSSubscriberModule.html#ga17">DDS_Subscriber_notify_datareaders()</a> to invoke the <a class="el" href="structDDS__DataReaderListener.html">DDS_DataReaderListener</a> for each of the data readers. <div class="fragment"><pre class="fragment">  <a class="code" href="group__DDSReturnTypesModule.html#ga13">DDS_ReturnCode_t</a> retcode;

  retcode = <a class="code" href="group__DDSSubscriberModule.html#ga17">DDS_Subscriber_notify_datareaders</a>(subscriber);

  <span class="keywordflow">if</span> (retcode != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
      printf(<span class="stringliteral">"***Error: failed to notify datareaders\n"</span>);
  }
</pre></div></li></ul>
<h2><a class="anchor" name="DDSSubscriberExampleModule_receive_ordered">
Access received data coherently and/or in order</a></h2>
To access the received data coherently and/or in an ordered manner, according to the settings of the <a class="el" href="structDDS__PresentationQosPolicy.html">DDS_PresentationQosPolicy</a> attached to a DDS_Subscriber:<p>
<ul>
<li><a class="el" href="group__DDSSubscriberExampleModule.html#DDSSubscriberExampleModule_receive_setup">Ensure subscriber is set up to access received data</a></li></ul>
<p>
<ul>
<li>Indicate that data will be accessed via the subscriber: <div class="fragment"><pre class="fragment">  retcode = <a class="code" href="group__DDSSubscriberModule.html#ga14">DDS_Subscriber_begin_access</a>(subscriber);

  <span class="keywordflow">if</span> (retcode != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
      printf(<span class="stringliteral">"***Error: failed to begin access\n"</span>);
  }
</pre></div></li></ul>
<p>
<ul>
<li><a class="el" href="group__DDSSubscriberExampleModule.html#DDSSubscriberExampleModule_receive">Access received data via the subscriber, making sure that the data readers are processed in the order returned.</a></li></ul>
<p>
<ul>
<li>Indicate that the data access via the subscriber is done: <div class="fragment"><pre class="fragment">  retcode = <a class="code" href="group__DDSSubscriberModule.html#ga15">DDS_Subscriber_end_access</a>(subscriber);

  <span class="keywordflow">if</span> (retcode != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
      printf(<span class="stringliteral">"***Error: failed to end access\n"</span>);
  }
</pre></div></li></ul>
<h2><a class="anchor" name="DDSSubscriberExampleModule_subscriber_teardown">
Tearing down a subscriber</a></h2>
<ul>
<li>Delete DDS_Subscriber: <div class="fragment"><pre class="fragment">    <a class="code" href="group__DDSReturnTypesModule.html#ga13">DDS_ReturnCode_t</a> retcode;

    retcode = <a class="code" href="group__DDSDomainParticipantModule.html#ga24">DDS_DomainParticipant_delete_subscriber</a>(participant, subscriber);

    <span class="keywordflow">if</span> (retcode != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
        printf(<span class="stringliteral">"***Error: failed to delete subscriber\n"</span>);
    }
</pre></div> </li></ul>
<HR>
<IMG SRC="rti_logo.gif" height="16">
<A HREF="main.html">RTI Data Distribution Service C API Version 4.2e (General Access Release)</A>
Copyright &copy; 4 Dec 2007 
<A HREF="http://www.rti.com">Real-Time Innovations, Inc</A>
</BODY>
</HTML>
