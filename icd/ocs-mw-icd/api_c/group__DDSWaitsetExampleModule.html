<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RTI Data Distribution Service C API: Waitset Use Cases</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>Waitset Use Cases<br>
<small>
[<a class="el" href="group__DDSHowToModule.html">Programming How-To's</a>]</small>
</h1>Using wait-sets and conditions.  
<a href="#_details">More...</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
</table>
<h2><a class="anchor" name="DDSWaitsetExampleModule_setup">
Setting up a wait-set</a></h2>
<ul>
<li>Create a wait-set <div class="fragment"><pre class="fragment">  <a class="code" href="group__DDSConditionsModule.html#ga3">DDS_WaitSet</a>* waitset = <a class="code" href="group__DDSConditionsModule.html#ga13">DDS_WaitSet_new</a>();
</pre></div></li></ul>
<p>
<ul>
<li>Attach conditions <div class="fragment"><pre class="fragment">  <a class="code" href="group__DDSConditionsModule.html#ga0">DDS_Condition</a>* cond1 = ...;
  <a class="code" href="group__DDSConditionsModule.html#ga0">DDS_Condition</a>* cond2 = <a class="code" href="group__DDSConditionsModule.html#ga9">DDS_StatusCondition_as_condition</a>(
                                <a class="code" href="group__DDSEntityModule.html#ga3">DDS_Entity_get_statuscondition</a>(entity));
  <a class="code" href="group__DDSConditionsModule.html#ga0">DDS_Condition</a>* cond3 = <a class="code" href="group__DDSReadConditionModule.html#ga1">DDS_ReadCondition_as_condition</a>(
                                <a class="code" href="group__DDSReaderModule.html#ga47">DDS_DataReader_create_readcondition</a>(
                                        reader, 
                                                         <a class="code" href="group__DDSSampleStateModule.html#gga2a50">DDS_NOT_READ_SAMPLE_STATE</a>,
                                        <a class="code" href="group__DDSViewStateModule.html#ga1">DDS_ANY_VIEW_STATE</a>,
                                        <a class="code" href="group__DDSInstanceStateModule.html#ga1">DDS_ANY_INSTANCE_STATE</a>));
  <a class="code" href="group__DDSConditionsModule.html#ga0">DDS_Condition</a>* cond4 = <a class="code" href="group__DDSConditionsModule.html#ga5">DDS_GuardCondition_as_condition</a>(
                                <a class="code" href="group__DDSConditionsModule.html#ga6">DDS_GuardCondition_new</a>());
  <a class="code" href="group__DDSConditionsModule.html#ga0">DDS_Condition</a>* cond5 = ...;                                              
  <a class="code" href="group__DDSReturnTypesModule.html#ga13">DDS_ReturnCode_t</a> retcode;

  retcode = <a class="code" href="group__DDSConditionsModule.html#ga16">DDS_WaitSet_attach_condition</a>(waitset, cond1);
  <span class="keywordflow">if</span> (retcode != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
      <span class="comment">/* ... error */</span>
  }
  retcode = <a class="code" href="group__DDSConditionsModule.html#ga16">DDS_WaitSet_attach_condition</a>(waitset, cond2);
  <span class="keywordflow">if</span> (retcode != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
      <span class="comment">/* ... error */</span>
  }
  retcode = <a class="code" href="group__DDSConditionsModule.html#ga16">DDS_WaitSet_attach_condition</a>(waitset, cond3);
  <span class="keywordflow">if</span> (retcode != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
      <span class="comment">/* ... error */</span>
  }
  retcode = <a class="code" href="group__DDSConditionsModule.html#ga16">DDS_WaitSet_attach_condition</a>(waitset, cond4);
  <span class="keywordflow">if</span> (retcode != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
      <span class="comment">/* ... error */</span>
  }
  retcode = <a class="code" href="group__DDSConditionsModule.html#ga16">DDS_WaitSet_attach_condition</a>(waitset, cond5);
  <span class="keywordflow">if</span> (retcode != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
      <span class="comment">/* ... error */</span>
  }
</pre></div></li></ul>
<h2><a class="anchor" name="DDSWaitsetExampleModule_trigger">
Waiting for condition(s) to trigger</a></h2>
<ul>
<li><a class="el" href="group__DDSWaitsetExampleModule.html#DDSWaitsetExampleModule_setup">Set up a wait-set</a></li></ul>
<p>
<ul>
<li>Wait for a condition to trigger or <code>timeout</code>, whichever occurs first <div class="fragment"><pre class="fragment"><span class="preprocessor">  #define TRUE 1</span>
<span class="preprocessor"></span><span class="preprocessor">  #define FALSE 0</span>
<span class="preprocessor"></span>  <span class="keyword">struct </span><a class="code" href="structDDS__Duration__t.html">DDS_Duration_t</a> timeout = { 0, 1000000 }; <span class="comment">/* 1ms */</span>

  <span class="keyword">struct </span><a class="code" href="structDDS__ConditionSeq.html">DDS_ConditionSeq</a> active_conditions = <a class="code" href="group__DDSSequenceModule.html#ga17">DDS_SEQUENCE_INITIALIZER</a>; <span class="comment">/* holder for active conditions */</span>

  <span class="keywordtype">int</span> is_cond1_triggered = FALSE;
  <span class="keywordtype">int</span> is_cond2_triggered = FALSE;
  <span class="keywordtype">int</span> i;

  <a class="code" href="group__DDSReturnTypesModule.html#ga13">DDS_ReturnCode_t</a> retcode;

  retcode = <a class="code" href="group__DDSConditionsModule.html#ga15">DDS_WaitSet_wait</a>(waitset, &amp;active_conditions, &amp;timeout);

  <span class="keywordflow">if</span> (retcode != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {

      <span class="comment">/* ... check for cause of failure */</span>

  } <span class="keywordflow">else</span> {
     <span class="comment">/* success */</span>
  
     <span class="keywordflow">if</span> (DDS_ConditionSeq_get_length(&amp;active_conditions) == 0) {
        <span class="comment">/* timeout! */</span>
        printf(<span class="stringliteral">"Wait timed out!! None of the conditions was triggered.\n"</span>);

     } <span class="keywordflow">else</span> {
        <span class="comment">/* check if "cond1" or "cond2" are triggered: */</span>
        <span class="keywordflow">for</span>(i = 0; i &lt; DDS_ConditionSeq_get_length(&amp;active_conditions); ++i) {

           <span class="keywordflow">if</span> (DDS_ConditionSeq_get(&amp;active_conditions, i) == cond1) {
              printf(<span class="stringliteral">"Cond1 was triggered!"</span>);
              is_cond1_triggered = TRUE;              
           }

           <span class="keywordflow">if</span> (DDS_ConditionSeq_get(&amp;active_conditions, i) == cond2) {
              printf(<span class="stringliteral">"Cond2 was triggered!"</span>);
              is_cond2_triggered = TRUE;              
           }

           <span class="keywordflow">if</span> (is_cond1_triggered &amp;&amp; is_cond2_triggered) {
              <span class="keywordflow">break</span>;
           }   
        }   
     }
  }  

  <span class="keywordflow">if</span> (is_cond1_triggered) {
     <span class="comment">/* ... do something because "cond1" was triggered ... */</span>
  }

  <span class="keywordflow">if</span> (is_cond2_triggered) {
     <span class="comment">/* ... do something because "cond2" was triggered ... */</span>
  }
</pre></div></li></ul>
<h2><a class="anchor" name="DDSWaitsetExampleModule_teradown">
Tearing down a wait-set</a></h2>
<ul>
<li>Delete the wait-set <div class="fragment"><pre class="fragment">  <a class="code" href="group__DDSConditionsModule.html#ga14">DDS_WaitSet_delete</a>(waitset);
  waitset = NULL;
</pre></div> </li></ul>
<HR>
<IMG SRC="rti_logo.gif" height="16">
<A HREF="main.html">RTI Data Distribution Service C API Version 4.2e (General Access Release)</A>
Copyright &copy; 4 Dec 2007 
<A HREF="http://www.rti.com">Real-Time Innovations, Inc</A>
</BODY>
</HTML>
