<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RTI Data Distribution Service Java API: FlowController Use Cases</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Packages</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>FlowController Use Cases<br>
<small>
[<a class="el" href="group__DDSHowToModule.html">Programming How-To's</a>]</small>
</h1>Working with flow controllers.  
<a href="#_details">More...</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
</table>
<h2><a class="anchor" name="DDSFlowControllerExampleModule_setup">
Creating a flow controller</a></h2>
<ul>
<li><a class="el" href="group__DDSParticipantExampleModule.html#DDSParticipantExampleModule_setup">Set up participant</a></li></ul>
<p>
<ul>
<li>Create a flow controller <div class="fragment"><pre class="fragment">    FlowController controller = null;
    FlowControllerProperty_t property = <span class="keyword">new</span> FlowControllerProperty_t();
    
    retcode = participant.get_default_flowcontroller_property(property);
    
    <span class="comment">// optionally modify flow controller property values</span>
    
    <span class="keywordflow">try</span> {
        controller = participant.create_flowcontroller(
            <span class="stringliteral">"my flow controller name"</span>, property);
    } <span class="keywordflow">catch</span> (RETCODE_ERROR err) {
        <span class="comment">// handle exception</span>
    }
</pre></div></li></ul>
<h2><a class="anchor" name="DDSFlowControllerExampleModule_using">
Flow controlling a data writer</a></h2>
<ul>
<li><a class="el" href="group__DDSParticipantExampleModule.html#DDSParticipantExampleModule_setup">Set up participant</a></li></ul>
<p>
<ul>
<li><a class="el" href="group__DDSFlowControllerExampleModule.html#DDSFlowControllerExampleModule_setup">Create flow controller</a></li></ul>
<p>
<ul>
<li>Create an asynchronous data writer, FooDataWriter, of user data type <code>Foo:</code> <div class="fragment"><pre class="fragment">    DataWriterQos writer_qos = <span class="keyword">new</span> DataWriterQos();

    <span class="comment">// MyWriterListener is user defined and </span>
    <span class="comment">// implements DataWriterListener</span>
    MyWriterListener writer_listener = <span class="keyword">new</span> MyWriterListener(); <span class="comment">// or = null</span>

    publisher.get_default_datawriter_qos(writer_qos);

    <span class="comment">/* Change the writer QoS to publish asnychronously */</span>
    writer_qos.publish_mode.kind = PublishModeQosPolicyKind.ASYNCHRONOUS_PUBLISH_MODE_QOS;

    <span class="comment">/* Setup to use the previously created flow controller */</span>
    writer_qos.publish_mode.flow_controller_name = <span class="stringliteral">"my flow controller name"</span>;

    <span class="comment">/* Samples queued for asynchronous write are subject to the History Qos policy */</span>
    writer_qos.history.kind = HistoryQosPolicyKind.KEEP_ALL_HISTORY_QOS;

    FooDataWriter writer = null;
    <span class="keywordflow">try</span> {
        writer = (FooDataWriter) publisher.create_datawriter(topic, writer_qos,
                                                             writer_listener,
                                                             StatusKind.STATUS_MASK_ALL);


        <span class="comment">/* Send data asynchronously... */</span>
        
        <span class="comment">/* Wait for asynchronous send completes, if desired */</span>
        writer.wait_for_asynchronous_publishing(timout);

    } <span class="keywordflow">catch</span> (RETCODE_ERROR err) {
        <span class="comment">// handle exception</span>
    }
</pre></div></li></ul>
<h2><a class="anchor" name="DDSFlowControllerExampleModule_builtin">
Using the built-in flow controllers</a></h2>
RTI Data Distribution Service provides several built-in flow controllers.<p>
The <a class="el" href="group__DDSFlowControllerModule.html#ga0">com.rti.dds.publication.FlowController.DEFAULT_FLOW_CONTROLLER_NAME</a> built-in flow controller provides the basic asynchronous writer behavior. When calling com.rti.dds.topic.example.FooDataWriter.write, the call signals the <a class="el" href="interfacecom_1_1rti_1_1dds_1_1publication_1_1Publisher.html">com.rti.dds.publication.Publisher</a> asynchronous publishing thread (<a class="el" href="classcom_1_1rti_1_1dds_1_1publication_1_1PublisherQos.html#o4">com.rti.dds.publication.PublisherQos.asynchronous_publisher</a>) to send the actual data. As with any <a class="el" href="classcom_1_1rti_1_1dds_1_1infrastructure_1_1PublishModeQosPolicyKind.html#s1">com.rti.dds.infrastructure.PublishModeQosPolicyKind.ASYNCHRONOUS_PUBLISH_MODE_QOS</a> <a class="el" href="interfacecom_1_1rti_1_1dds_1_1publication_1_1DataWriter.html">com.rti.dds.publication.DataWriter</a>, the com.rti.dds.topic.example.FooDataWriter.write call returns immediately afterwards. The data is sent immediately in the context of the <a class="el" href="interfacecom_1_1rti_1_1dds_1_1publication_1_1Publisher.html">com.rti.dds.publication.Publisher</a> asynchronous publishing thread.<p>
When using the <a class="el" href="group__DDSFlowControllerModule.html#ga1">com.rti.dds.publication.FlowController.FIXED_RATE_FLOW_CONTROLLER_NAME</a> flow controller, data is also sent in the context of the <a class="el" href="interfacecom_1_1rti_1_1dds_1_1publication_1_1Publisher.html">com.rti.dds.publication.Publisher</a> asynchronous publishing thread, but at a regular fixed interval. The thread accumulates samples from different <a class="el" href="interfacecom_1_1rti_1_1dds_1_1publication_1_1DataWriter.html">com.rti.dds.publication.DataWriter</a> instances and generates data on the wire only once per <a class="el" href="classcom_1_1rti_1_1dds_1_1publication_1_1FlowControllerTokenBucketProperty__t.html#o3">com.rti.dds.publication.FlowControllerTokenBucketProperty_t.period</a>.<p>
In contrast, the <a class="el" href="group__DDSFlowControllerModule.html#ga2">com.rti.dds.publication.FlowController.ON_DEMAND_FLOW_CONTROLLER_NAME</a> flow controller permits flow only when <a class="el" href="interfacecom_1_1rti_1_1dds_1_1publication_1_1FlowController.html#a4">com.rti.dds.publication.FlowController.trigger_flow</a> is called. The data is still sent in the context of the <a class="el" href="interfacecom_1_1rti_1_1dds_1_1publication_1_1Publisher.html">com.rti.dds.publication.Publisher</a> asynchronous publishing thread. The thread accumulates samples from different <a class="el" href="interfacecom_1_1rti_1_1dds_1_1publication_1_1DataWriter.html">com.rti.dds.publication.DataWriter</a> instances (across any <a class="el" href="interfacecom_1_1rti_1_1dds_1_1publication_1_1Publisher.html">com.rti.dds.publication.Publisher</a>) and sends all data since the previous trigger.<p>
The properties of the built-in <a class="el" href="interfacecom_1_1rti_1_1dds_1_1publication_1_1FlowController.html">com.rti.dds.publication.FlowController</a> instances can be adjusted.<p>
<ul>
<li><a class="el" href="group__DDSParticipantExampleModule.html#DDSParticipantExampleModule_setup">Set up participant</a></li></ul>
<p>
<ul>
<li>Lookup built-in flow controller <div class="fragment"><pre class="fragment">    FlowController controller = null;

    <span class="keywordflow">try</span> {
        controller = participant.lookup_flowcontroller(
            FlowController.DEFAULT_FLOW_CONTROLLER_NAME);
    } <span class="keywordflow">catch</span> (RETCODE_ERROR err) {
        <span class="comment">// This should never happen, built-in flow controllers are always created</span>
        <span class="comment">// handle exception</span>
    }
</pre></div></li></ul>
<p>
<ul>
<li>Change property of built-in flow controller, if desired <div class="fragment"><pre class="fragment">    FlowControllerProperty_t property = <span class="keyword">new</span> FlowControllerProperty_t();

    <span class="comment">/* Get the property of the looked-up default flow controller */</span>
    controller.get_property(property);

    <span class="comment">/* Change the property value as desired */</span>
    property.token_bucket.period.sec = 2;
    property.token_bucket.period.nanosec = 0;

    <span class="comment">/* Update the flow controller property */</span>
    controller.set_property(property);
</pre></div></li></ul>
<p>
<ul>
<li><a class="el" href="group__DDSFlowControllerExampleModule.html#DDSFlowControllerExampleModule_using">Create a data writer using the correct flow controller name</a></li></ul>
<h2><a class="anchor" name="DDSFlowControllerExampleModule_trafficing">
Shaping the network traffic for a particular transport</a></h2>
<ul>
<li><a class="el" href="group__DDSParticipantExampleModule.html#DDSParticipantExampleModule_setup">Set up participant</a></li></ul>
<p>
<ul>
<li><a class="el" href="group__NDDSTransportExampleModule.html">Create the transports</a></li></ul>
<p>
<ul>
<li><a class="el" href="group__DDSFlowControllerExampleModule.html#DDSFlowControllerExampleModule_setup">Create a separate flow controller for each transport</a></li></ul>
<p>
<ul>
<li>Configure <a class="el" href="interfacecom_1_1rti_1_1dds_1_1publication_1_1DataWriter.html">com.rti.dds.publication.DataWriter</a> instances to only use a single transport</li></ul>
<p>
<ul>
<li><a class="el" href="group__DDSFlowControllerExampleModule.html#DDSFlowControllerExampleModule_using">Associate all data writers using the same transport to the corresponding flow controller</a></li></ul>
<p>
<ul>
<li>For each transport, the corresponding flow controller limits the network traffic based on the token bucket properties</li></ul>
<h2><a class="anchor" name="DDSFlowControllerExampleModule_coalescing">
Coalescing multiple samples in a single network packet</a></h2>
<ul>
<li><a class="el" href="group__DDSParticipantExampleModule.html#DDSParticipantExampleModule_setup">Set up participant</a></li></ul>
<p>
<ul>
<li><a class="el" href="group__DDSFlowControllerExampleModule.html#DDSFlowControllerExampleModule_setup">Create a flow controller with a desired token bucket period</a></li></ul>
<p>
<ul>
<li><a class="el" href="group__DDSFlowControllerExampleModule.html#DDSFlowControllerExampleModule_using">Associate the data writer with the flow controller</a></li></ul>
<p>
<ul>
<li>Multiple samples written within the specified period will be coalesced into a single network packet (provided that <code>tokens_added_per_period</code> and <code>bytes_per_token</code> permit). </li></ul>
<HR>
<IMG SRC="rti_logo.gif" height="16">
<A HREF="main.html">RTI Data Distribution Service Java API Version 4.2e (General Access Release)</A>
Copyright &copy; 4 Dec 2007 
<A HREF="http://www.rti.com">Real-Time Innovations, Inc</A>
</BODY>
</HTML>
