<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RTI Data Distribution Service C++ API: Transport Use Cases</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>Transport Use Cases<br>
<small>
[<a class="el" href="group__DDSHowToModule.html">Programming How-To's</a>]</small>
</h1>Working with pluggable transports.  
<a href="#_details">More...</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
</table>
<h2><a class="anchor" name="NDDSTransportExampleModule_change_builtin">
Changing the automatically registered builtin transports</a></h2>
<ul>
<li>The <a class="el" href="group__DDSTransportBuiltinQosModule.html#ga7">DDS_TRANSPORTBUILTIN_MASK_DEFAULT</a> specifies the transport plugins that will be automatically registered with a newly created <a class="el" href="classDDSDomainParticipant.html">DDSDomainParticipant</a> by default.</li></ul>
<p>
<ul>
<li>This default can be changed by changing the value of the value of <a class="el" href="group__DDSTransportBuiltinQosModule.html">TRANSPORT_BUILTIN</a> Qos Policy on the <a class="el" href="classDDSDomainParticipant.html">DDSDomainParticipant</a></li></ul>
<p>
<ul>
<li>To change the <a class="el" href="structDDS__DomainParticipantQos.html#o3">DDS_DomainParticipantQos::transport_builtin</a> Qos Policy: <div class="fragment"><pre class="fragment">
    <a class="code" href="structDDS__DomainParticipantQos.html">DDS_DomainParticipantQos</a> participant_qos;
    
    factory-&gt;<a class="code" href="classDDSDomainParticipantFactory.html#a2">get_default_participant_qos</a>(participant_qos);
    
    participant_qos.<a class="code" href="structDDS__DomainParticipantQos.html#o3">transport_builtin</a>.<a class="code" href="structDDS__TransportBuiltinQosPolicy.html#o0">mask</a> = <a class="code" href="group__DDSTransportBuiltinQosModule.html#gga9a314">DDS_TRANSPORTBUILTIN_SHMEM</a> |
                                             <a class="code" href="group__DDSTransportBuiltinQosModule.html#gga9a313">DDS_TRANSPORTBUILTIN_UDPv4</a>;
</pre></div></li></ul>
<h2><a class="anchor" name="NDDSTransportExampleModule_change_builtin_properties">
Changing the properties of the automatically registered builtin transports</a></h2>
The behavior of the automatically registered builtin transports can be altered by changing their properties.<p>
<ul>
<li>Tell the <a class="el" href="classDDSDomainParticipantFactory.html">DDSDomainParticipantFactory</a> to create the participants disabled, as descibed in <a class="el" href="group__DDSParticipantExampleModule.html#DDSParticipantExampleModule_no_autoenable">Turning off auto-enable of newly created participant(s)</a></li></ul>
<p>
<ul>
<li>Get the property of the desired builtin transport plugin, say ::<a class="el" href="group__NDDS__Transport__UDPv4__Plugin.html">UDPv4 Transport</a> <div class="fragment"><pre class="fragment">
    <span class="keyword">struct </span><a class="code" href="structNDDS__Transport__UDPv4__Property__t.html">NDDS_Transport_UDPv4_Property_t</a> property = <a class="code" href="group__NDDS__Transport__UDPv4__Plugin.html#ga12">NDDS_TRANSPORT_UDPV4_PROPERTY_DEFAULT</a>;
                
    <span class="keywordflow">if</span> (<a class="code" href="classNDDSTransportSupport.html#e4">NDDSTransportSupport::get_builtin_transport_property</a>(
                                          participant,
                                          <a class="code" href="group__DDSTransportBuiltinQosModule.html#gga9a313">DDS_TRANSPORTBUILTIN_UDPv4</a>,              
                                          (<span class="keyword">struct</span> <a class="code" href="structNDDS__Transport__Property__t.html">NDDS_Transport_Property_t</a>&amp;)property)
           != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
        printf(<span class="stringliteral">"***Error: get builtin transport property\n"</span>);                           
    }    
</pre></div></li></ul>
<p>
<ul>
<li>Change the property fields as desired. Note that the properties should be changed carefully, as inappropriate values may prevent communications. For example, the ::<a class="el" href="group__NDDS__Transport__UDPv4__Plugin.html">UDPv4 Transport</a> properties can be changed to support <b>large</b> <b>messages</b> (assuming the underlying operating system's UDPv4 stack supports the large message size): <div class="fragment"><pre class="fragment">
    <span class="comment">/* Increase the UDPv4 maximum message size to 64K (large messages). */</span>    
    property.parent.<a class="code" href="structNDDS__Transport__Property__t.html#o4">message_size_max</a> =  65535; 
    property.recv_socket_buffer_size =  65535;
    property.send_socket_buffer_size =  65535;            
</pre></div></li></ul>
<p>
<ul>
<li>Set the property of the desired builtin transport plugin, say ::<a class="el" href="group__NDDS__Transport__UDPv4__Plugin.html">UDPv4 Transport</a> <div class="fragment"><pre class="fragment">
    <span class="keywordflow">if</span> (<a class="code" href="classNDDSTransportSupport.html#e5">NDDSTransportSupport::set_builtin_transport_property</a>(
                                          participant,
                                          <a class="code" href="group__DDSTransportBuiltinQosModule.html#gga9a313">DDS_TRANSPORTBUILTIN_UDPv4</a>,              
                                          (<span class="keyword">struct</span> NDDS_Transport_Property_t&amp;)property)
           != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
        printf(<span class="stringliteral">"***Error: set builtin transport property\n"</span>);                           
    }    
</pre></div></li></ul>
<p>
<ul>
<li><a class="el" href="group__DDSEntityExampleModule.html#DDSEntityExampleModule_enable">Enable the participant</a> to turn on communications with other participants in the domain using the new properties for the automatically registered builtin transport plugins.</li></ul>
<h2><a class="anchor" name="NDDSTransportExampleModule_create_transport">
Creating a transport</a></h2>
<ul>
<li>A transport plugin is created using methods provided by the supplier of the transport plugin.</li></ul>
<p>
<ul>
<li>For example to create an instance of the ::<a class="el" href="group__NDDS__Transport__UDPv4__Plugin.html">UDPv4 Transport</a> <div class="fragment"><pre class="fragment">
    NDDS_Transport_Plugin* transport = NULL; 

    <span class="keyword">struct </span><a class="code" href="structNDDS__Transport__UDPv4__Property__t.html">NDDS_Transport_UDPv4_Property_t</a> property = <a class="code" href="group__NDDS__Transport__UDPv4__Plugin.html#ga12">NDDS_TRANSPORT_UDPV4_PROPERTY_DEFAULT</a>;

    transport = <a class="code" href="group__NDDS__Transport__UDPv4__Plugin.html#ga0">NDDS_Transport_UDPv4_new</a>(&amp;property);

    <span class="keywordflow">if</span> (transport == NULL) {
       printf(<span class="stringliteral">"***Error: creating transport plugin\n"</span>);
    }    
</pre></div></li></ul>
<h2><a class="anchor" name="NDDSTransportExampleModule_delete_transport">
Deleting a transport</a></h2>
<ul>
<li>A transport plugin can only be deleted only after the <a class="el" href="classDDSDomainParticipant.html">DDSDomainParticipant</a> with which it is registered is deleted.</li></ul>
<p>
<ul>
<li>The virtual destructor provided by the abstract transport plugin API can be used to delete a transport plugin. <div class="fragment"><pre class="fragment">
    transport-&gt;delete_cEA(transport, NULL);
</pre></div></li></ul>
<h2><a class="anchor" name="NDDSTransportExampleModule_setup">
Registering a transport with a participant</a></h2>
The basic steps for setting up transport plugins for use in an RTI Data Distribution Service application are described below.<p>
<ul>
<li>Tell the <a class="el" href="classDDSDomainParticipantFactory.html">DDSDomainParticipantFactory</a> to create the participants disabled, as descibed in <a class="el" href="group__DDSParticipantExampleModule.html#DDSParticipantExampleModule_no_autoenable">Turning off auto-enable of newly created participant(s)</a></li></ul>
<p>
<ul>
<li>[<b>Optionally</b>] <a class="el" href="group__NDDSTransportExampleModule.html#NDDSTransportExampleModule_change_builtin">Changing the automatically registered builtin transports</a></li></ul>
<p>
<ul>
<li>[<b>Optionally</b>] <a class="el" href="group__NDDSTransportExampleModule.html#NDDSTransportExampleModule_change_builtin_properties">Changing the properties of the automatically registered builtin transports</a></li></ul>
<p>
<ul>
<li>Create a disabled <a class="el" href="classDDSDomainParticipant.html">DDSDomainParticipant</a>, as descibed in <a class="el" href="group__DDSParticipantExampleModule.html#DDSParticipantExampleModule_setup">Setting up a participant</a></li></ul>
<p>
<ul>
<li>Decide on the <a class="el" href="group__NDDSTransportModule.html#NDDSTransportModule_net_address">network address</a> for the transport plugin. The network address should be chosen so that the resulting fully qualified address is globally unique (across all transports used in the domain). <div class="fragment"><pre class="fragment">
    <span class="comment">/* Decide on a network address (96 bits for UDPv4), such that the fully </span>
<span class="comment">       qualified unicast address for the transport's interfaces will be</span>
<span class="comment">       globally unique. For example, we use the network address:</span>
<span class="comment">                 1234:1234:1234:0000</span>
<span class="comment">       It will be prepended to the unicast addresses of the transport plugin's</span>
<span class="comment">       interfaces, to give a fully qualified address that is unique in the </span>
<span class="comment">       domain.</span>
<span class="comment">    */</span>
    <a class="code" href="structNDDS__Transport__Address__t.html">NDDS_Transport_Address_t</a> network_address = {{1,2,3,4, 1,2,3,4, 1,2,3,4, 0,0,0,0}};  
</pre></div></li></ul>
<p>
<ul>
<li>Decide on the <a class="el" href="group__NDDSTransportModule.html#NDDSTransportModule_aliases">aliases</a> for the transport plugin. An alias can refer to one or more transport plugins. The transport class name (see <a class="el" href="group__NDDS__DISCOVERY__PEERS.html#NDDS_DISCOVERY_PEERS_builtin_transport_class_names">Builtin Transport Class Names</a>) are automatically appended to the user provided aliases. Alias names are useful in creating logical groupings of transports, e.g. all the transports that are configured to support large messages may be given the alias "large_message". <div class="fragment"><pre class="fragment">
    <span class="comment">/* Decide aliases, i.e. the names by which this transport plugin will be known */</span>
    <span class="keyword">const</span> <span class="keywordtype">char</span>* ALIASES[] = {
        <span class="stringliteral">"my"</span>,
        <span class="stringliteral">"large_message"</span>,        
    };
    <span class="keyword">const</span> <a class="code" href="group__DDSCdrTypesModule.html#ga5">DDS_Long</a> ALIASES_LENGTH = <span class="keyword">sizeof</span>(ALIASES)/<span class="keyword">sizeof</span>(<span class="keyword">const</span> <span class="keywordtype">char</span>*);
    
    <span class="comment">/* Initialize the aliases StringSeq */</span>
    <a class="code" href="structDDS__StringSeq.html">DDS_StringSeq</a> aliases;
    <span class="keywordflow">if</span> (!aliases.from_array(ALIASES, ALIASES_LENGTH)) {
        printf(<span class="stringliteral">"***Error: creating initializing aliases\n"</span>); 
    }
</pre></div></li></ul>
<p>
<ul>
<li>Register the transport plugin with the <a class="el" href="classDDSDomainParticipant.html">DDSDomainParticipant</a>. Note that a transport plugin should <b>NOT be registered with more than one DomainParticipant</b>. It is the responsibility of the application programmer to ensure that this requirement is not violated. <div class="fragment"><pre class="fragment">
    <a class="code" href="group__NDDSTransportUserModule.html#ga0">NDDS_Transport_Handle_t</a> handle = <a class="code" href="group__NDDSTransportUserModule.html#ga1">NDDS_TRANSPORT_HANDLE_NIL</a>;
    
    handle = <a class="code" href="classNDDSTransportSupport.html#e0">NDDSTransportSupport::register_transport</a>(
                           participant,          <span class="comment">/* Disabled Domain Participant */</span>
                           transport,            <span class="comment">/* Transport plugin */</span>
                           aliases,              <span class="comment">/* Transport aliases */</span>
                           network_address);     <span class="comment">/* Transport network address */</span>

    <span class="keywordflow">if</span> (<a class="code" href="group__NDDSTransportUserModule.html#ga3">NDDS_Transport_Handle_is_nil</a>(&amp;handle)) {
       printf(<span class="stringliteral">"***Error: registering transport\n"</span>);       
    }     
</pre></div></li></ul>
<p>
<ul>
<li>[<b>Optionally</b>] <a class="el" href="group__NDDSTransportExampleModule.html#NDDSTransportExampleModule_recv_route">Adding receive routes for a transport</a></li></ul>
<p>
<ul>
<li>[<b>Optionally</b>] <a class="el" href="group__NDDSTransportExampleModule.html#NDDSTransportExampleModule_send_route">Adding send routes for a transport</a></li></ul>
<p>
<ul>
<li><a class="el" href="group__DDSEntityExampleModule.html#DDSEntityExampleModule_enable">Enable the participant</a> to turn on communications with other participants in the domain, using the newly registered transport plugins, and automatically registered builtin transport plugins (if any).</li></ul>
<h2><a class="anchor" name="NDDSTransportExampleModule_recv_route">
Adding receive routes for a transport</a></h2>
<ul>
<li>Receive routes can be added to restrict address ranges on which incoming messages can be received. Any number of receive routes can be added, but these must be done before the participant is enabled.</li></ul>
<p>
<ul>
<li>To restrict the address range from which incoming messages can be received by the transport plugin: <div class="fragment"><pre class="fragment">
    <span class="comment">/* Restrict to receiving messages only on interfaces </span>
<span class="comment">                1234:1234:1234:10.10.*.* </span>
<span class="comment">    */</span>
    <a class="code" href="structNDDS__Transport__Address__t.html">NDDS_Transport_Address_t</a> subnet = {{1,2,3,4, 1,2,3,4, 1,2,3,4, 10,10,0,0}};

    <span class="keywordflow">if</span> (<a class="code" href="classNDDSTransportSupport.html#e3">NDDSTransportSupport::add_receive_route</a>(handle, subnet, 112) 
                                != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
       printf(<span class="stringliteral">"***Error: adding receive route\n"</span>);
    }     
</pre></div></li></ul>
<h2><a class="anchor" name="NDDSTransportExampleModule_send_route">
Adding send routes for a transport</a></h2>
<ul>
<li>Send routes can be added to restrict the address ranges to which outgoing messages can be sent by the transport plugin. Any number of send routes can be added, but these must be done before the participant is enabled.</li></ul>
<p>
<ul>
<li>To restrict address ranges to which outgoing messages can be sent by the transport plugin: <div class="fragment"><pre class="fragment">
    <span class="comment">/* Restrict to sending messages only to addresses (subnets)</span>
<span class="comment">                  1234:1234:1234:10.10.30.*</span>
<span class="comment">    */</span>
    <a class="code" href="structNDDS__Transport__Address__t.html">NDDS_Transport_Address_t</a> subnet = {{1,2,3,4, 1,2,3,4, 1,2,3,4, 10,10,30,0}};

    <span class="keywordflow">if</span> (<a class="code" href="classNDDSTransportSupport.html#e2">NDDSTransportSupport::add_send_route</a>(handle, subnet, 120) 
                                != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
       printf(<span class="stringliteral">"***Error: adding send route\n"</span>);
    }     
</pre></div> </li></ul>
<HR>
<IMG SRC="rti_logo.gif" height="16">
<A HREF="main.html">RTI Data Distribution Service C++ API Version 4.2e (General Access Release)</A>
Copyright &copy; 4 Dec 2007 
<A HREF="http://www.rti.com">Real-Time Innovations, Inc</A>
</BODY>
</HTML>
