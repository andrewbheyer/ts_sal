#==============================================================================
# Makefile to generate the SALLV Binding for LabVIEW - NL - SOLEIL
#============================================================================== 

#==============================================================================
# OMNIORB
#==============================================================================
#OMNIORB_INSTALL_DIR = <your-omniorb-install-path>
#OMNIORB_INSTALL_DIR=/home/SALLV/omniorb-4.1.4-build-gcc-4.2
OMNIORB_INSTALL_DIR=/opt/omniORB-4.1.4-gcc-4.2.4-build

#==============================================================================
# SALLV
#==============================================================================
#SALLV_INSTALL_DIR = <your-SALLV-install-path>
#SALLV_INSTALL_DIR=/home/SALLV/SALLV-7.2.1-build-gcc-4.2
SALLV_INSTALL_DIR=/opt/lsstsal/scripts/code/SALLV-0.1-gcc-4.2.4-build

#==============================================================================
# GCC
#==============================================================================
#GCC_INSTALL_DIR = <your-gcc-install-path>
GCC_INSTALL_DIR=/usr/bin
#GCC_INSTALL_DIR=/usr/Local/gcc/gcc-4.2.4

#==============================================================================
# LABVIEW
#==============================================================================
#LABVIEW_INSTALL_DIR = <your-lv-install-path>
#LABVIEW_INSTALL_DIR=/usr/local/natinst/LabVIEW-2010
LABVIEW_INSTALL_DIR=/usr/Local/labview/labview-10.0/LabVIEW-2010

#==============================================================================
# BINDING INSTALL DIR
#==============================================================================
BINDING_INSTALL_DIR=../vis

#==============================================================================
# INCLUDE DIRS
#==============================================================================
INCLUDE_DIRS = -I. \
               -I$(OMNIORB_INSTALL_DIR)/include \
               -I$(SALLV_INSTALL_DIR)/include/SALLV \
               -I$(LABVIEW_INSTALL_DIR)/cintools

#==============================================================================
# LIB DIRS
#==============================================================================
LIB_DIRS = -L. \
           -L$(OMNIORB_INSTALL_DIR)/lib/static \
           -L$(SALLV_INSTALL_DIR)/lib/static \
           -L$(GCC_INSTALL_DIR)/lib

#==============================================================================
# BINDING SHARED LIB: NAME & EXTENSION
#==============================================================================
LVB_NAME = SALLV_binding
LVB_EXT = dll

#==============================================================================
# GCC-VERSION
#==============================================================================
GCC_VERS=4.2.4
#GCC_VERS=4.2

#==============================================================================
# COMP$(CC)ILER/LINKER OPTIONS for GNU/LINUX
#==============================================================================
CC=gcc-$(GCC_VERS)
CXX=g++-$(GCC_VERS)
#------------------------------------------------------------------------------
LVB_LIB_CFLAGS  = -fPIC -D_REENTRANT
LVB_LIB_CFLAGS += -Wno-uninitialized -fno-enforce-eh-specs
LVB_LIB_CFLAGS += -O3
LVB_LIB_CFLAGS += -g
#------------------------------------------------------------------------------
LVB_CFLAGS = $(LVB_LIB_CFLAGS)
#------------------------------------------------------------------------------
LD=gcc-$(GCC_VERS)
#------------------------------------------------------------------------------
LVB_LDFLAGS  = -shared -O -pthread
LVB_LDFLAGS += -Wl,--version-script,SALLV_binding.map
LVB_LDFLAGS += -Wl,-soname,$(LVB_NAME).$(LVB_EXT)
#------------------------------------------------------------------------------

#------------------------------------------------------------------------------
# LIBS for LVB
#------------------------------------------------------------------------------
LVB_LIBS = -lSALLV \
           -llog4SALLV \
           -lomniDynamic4 \
           -lCOS4 \
           -lomniORB4 \
           -lomnithread \
           -lstdc++
           
#------------------------------------------------------------------------------
# OBJS FILES
#------------------------------------------------------------------------------
LVB_OBJS = SALLVBinding.so.o \
	   ThreadSafeSubsysProxy.so.o \
           SubsysDescriptor.so.o \
           SubsysRepository.so.o \
           DataAdapter.so.o \
           Endianness.so.o \
           ErrorStack.so.o \
           EventManager.so.o \
           ObjectManager.so.o

#------------------------------------------------------------------------------
# RULE for LVB_ .cpp 
#------------------------------------------------------------------------------
.SUFFIXES: .so.o .cpp
.cpp.so.o:
	$(CC) $(LVB_CFLAGS) $(INCLUDE_DIRS) -c -o $@ $<

#------------------------------------------------------------------------------
# RULE: all
#------------------------------------------------------------------------------
all: release

#------------------------------------------------------------------------------
# RULE: release
#------------------------------------------------------------------------------
release: build_lvb install

#------------------------------------------------------------------------------
# RULE: release
#------------------------------------------------------------------------------
debug: build_lvb install

#------------------------------------------------------------------------------
# RULE: build_lvb
#------------------------------------------------------------------------------
build_lvb: $(LVB_OBJS)
	$(LD) $(LVB_LDFLAGS) $(LVB_OBJS) $(LIB_DIRS) $(LVB_LIBS) -o $(LVB_NAME).$(LVB_EXT)

#------------------------------------------------------------------------------
# RULE: install
#------------------------------------------------------------------------------
install:
	cp -f ./$(LVB_NAME).$(LVB_EXT) $(BINDING_INSTALL_DIR)

#------------------------------------------------------------------------------
# RULE: clean
#------------------------------------------------------------------------------
clean:
	rm -f *.o *.so.o *~ 
	rm -f $(LVB_NAME).$(LVB_EXT) 
	rm -f ../vis/$(LVB_NAME).$(LVB_EXT)



	








