<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RTI Data Distribution Service Java API: HelloWorldSubscriber.java</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="namespaces.html">Packages</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>HelloWorldSubscriber.java</h1><h2><a class="anchor" name="HelloWorldSubscription">
RTI Data Distribution Service Subscription Example</a></h2>
The unmodified subscription example generated by <a class="el" href="group__DDSNddsgenModule.html">rtiddsgen</a>.<h3><a class="anchor" name="HelloWorldPublication_src">
HelloWorldPublisher.java</a></h3>
[$(NDDSHOME)/example/JAVA/helloWorld/HelloWorldSubscriber.java]<p>
<div class="fragment"><pre class="fragment">                    

<span class="comment">/* HelloWorldSubscriber.java</span>
<span class="comment"></span>
<span class="comment">   A publication of data of type HelloWorld</span>
<span class="comment"></span>
<span class="comment">   This file is derived from code automatically generated by the rtiddsgen </span>
<span class="comment">   command:</span>
<span class="comment"></span>
<span class="comment">   rtiddsgen -language java -example &lt;arch&gt; HelloWorld.idl</span>
<span class="comment"></span>
<span class="comment">   Example publication of type HelloWorld automatically generated by </span>
<span class="comment">   'rtiddsgen' To test them follow these steps:</span>
<span class="comment"></span>
<span class="comment">   (1) Compile this file and the example subscription.</span>
<span class="comment"></span>
<span class="comment">   (2) Start the subscription on the same domain used for RTI Data Distribution</span>
<span class="comment">       Service with the command</span>
<span class="comment">       java HelloWorldSubscriber &lt;domain_id&gt; &lt;sample_count&gt;</span>
<span class="comment"></span>
<span class="comment">   (3) Start the publication on the same domain used for RTI Data Distribution</span>
<span class="comment">       Service with the command</span>
<span class="comment">       java HelloWorldPublisher &lt;domain_id&gt; &lt;sample_count&gt;</span>
<span class="comment"></span>
<span class="comment">   (4) [Optional] Specify the list of discovery initial peers and </span>
<span class="comment">       multicast receive addresses via an environment variable or a file </span>
<span class="comment">       (in the current working directory) called NDDS_DISCOVERY_PEERS. </span>
<span class="comment">       </span>
<span class="comment">   You can run any number of publishers and subscribers programs, and can </span>
<span class="comment">   add and remove them dynamically from the domain.</span>
<span class="comment">              </span>
<span class="comment">                                   </span>
<span class="comment">   Example:</span>
<span class="comment">        </span>
<span class="comment">       To run the example application on domain &lt;domain_id&gt;:</span>
<span class="comment">            </span>
<span class="comment">       Ensure that $(NDDSHOME)/lib/&lt;arch&gt; is on the dynamic library path for</span>
<span class="comment">       Java.                       </span>
<span class="comment">       </span>
<span class="comment">        On Unix: </span>
<span class="comment">             add $(NDDSHOME)/lib/&lt;arch&gt; to the 'LD_LIBRARY_PATH' environment</span>
<span class="comment">             variable</span>
<span class="comment">                                         </span>
<span class="comment">        On Windows:</span>
<span class="comment">             add $(NDDSHOME)\lib&lt;arch&gt; to the 'Path' environment variable</span>
<span class="comment">                        </span>
<span class="comment"></span>
<span class="comment">       Run the Java applications:</span>
<span class="comment">       </span>
<span class="comment">        java -Djava.ext.dirs=$NDDSHOME/class HelloWorldPublisher &lt;domain_id&gt;</span>
<span class="comment"></span>
<span class="comment">        java -Djava.ext.dirs=$NDDSHOME/class HelloWorldSubscriber &lt;domain_id&gt;  </span>
<span class="comment">       </span>
<span class="comment">       </span>
<span class="comment">modification history</span>
<span class="comment">------------ -------   </span>
<span class="comment">*/</span>

<span class="keyword">import</span> java.net.InetAddress;
<span class="keyword">import</span> java.net.UnknownHostException;
<span class="keyword">import</span> java.util.Arrays;

<span class="keyword">import</span> com.rti.dds.domain.*;
<span class="keyword">import</span> com.rti.dds.infrastructure.*;
<span class="keyword">import</span> com.rti.dds.subscription.*;
<span class="keyword">import</span> com.rti.dds.topic.*;
<span class="keyword">import</span> com.rti.ndds.config.*;

<span class="comment">// ===========================================================================</span>

<span class="keyword">public</span> <span class="keyword">class </span>HelloWorldSubscriber {
    <span class="comment">// -----------------------------------------------------------------------</span>
    <span class="comment">// Public Methods</span>
    <span class="comment">// -----------------------------------------------------------------------</span>
    
    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">void</span> main(String[] args) {
        <span class="comment">// --- Get domain ID --- //</span>
        <span class="keywordtype">int</span> domainId = 0;
        <span class="keywordflow">if</span> (args.length &gt;= 1) {
            domainId = Integer.valueOf(args[0]).intValue();
        }
        
        <span class="comment">// -- Get max loop count; 0 means infinite loop --- //</span>
        <span class="keywordtype">int</span> sampleCount = 0;
        <span class="keywordflow">if</span> (args.length &gt;= 2) {
            sampleCount = Integer.valueOf(args[1]).intValue();
        }
        
        
        <span class="comment">/* Uncomment this to turn on additional logging</span>
<span class="comment">        Logger.get_instance().set_verbosity_by_category(</span>
<span class="comment">            LogCategory.NDDS_CONFIG_LOG_CATEGORY_API,</span>
<span class="comment">            LogVerbosity.NDDS_CONFIG_LOG_VERBOSITY_STATUS_ALL);</span>
<span class="comment">        */</span>
        
        <span class="comment">// --- Run --- //</span>
        subscriberMain(domainId, sampleCount);
    }
    
    
    
    <span class="comment">// -----------------------------------------------------------------------</span>
    <span class="comment">// Private Methods</span>
    <span class="comment">// -----------------------------------------------------------------------</span>
    
    <span class="comment">// --- Constructors: -----------------------------------------------------</span>
    
    <span class="keyword">private</span> HelloWorldSubscriber() {
        super();
    }
    
    
    <span class="comment">// -----------------------------------------------------------------------</span>
    
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">void</span> subscriberMain(<span class="keywordtype">int</span> domainId, <span class="keywordtype">int</span> sampleCount) {

        DomainParticipant participant = null;
        Subscriber subscriber = null;
        Topic topic = null;
        DataReaderListener listener = null;
        HelloWorldDataReader reader = null;

        <span class="keywordflow">try</span> {

            <span class="comment">// --- Create participant --- //</span>
                       
            <span class="comment">/* To customize participant QoS, use</span>
<span class="comment">               DomainParticipantFactory.TheParticipantFactory.</span>
<span class="comment">               get_default_participant_qos() */</span>
            participant = DomainParticipantFactory.TheParticipantFactory.
                create_participant(
                    domainId, DomainParticipantFactory.PARTICIPANT_QOS_DEFAULT,
                    null <span class="comment">/* listener */</span>, StatusKind.STATUS_MASK_NONE);
            <span class="keywordflow">if</span> (participant == null) {
                System.err.println(<span class="stringliteral">"create_participant error\n"</span>);
                <span class="keywordflow">return</span>;
            }                         

            <span class="comment">// --- Create subscriber --- //</span>

            <span class="comment">/* To customize subscriber QoS, use</span>
<span class="comment">               participant.get_default_subscriber_qos() */</span>
            subscriber = participant.create_subscriber(
                DomainParticipant.SUBSCRIBER_QOS_DEFAULT, null <span class="comment">/* listener */</span>,
                StatusKind.STATUS_MASK_NONE);
            <span class="keywordflow">if</span> (subscriber == null) {
                System.err.println(<span class="stringliteral">"create_subscriber error\n"</span>);
                <span class="keywordflow">return</span>;
            }     
                
            <span class="comment">// --- Create topic --- //</span>
        
            <span class="comment">/* Register type before creating topic */</span>
            String typeName = HelloWorldTypeSupport.get_type_name(); 
            HelloWorldTypeSupport.register_type(participant, typeName);

            <span class="comment">/* To customize topic QoS, use</span>
<span class="comment">               participant.get_default_topic_qos() */</span>
            topic = participant.create_topic(
                <span class="stringliteral">"Example HelloWorld"</span>,
                typeName, DomainParticipant.TOPIC_QOS_DEFAULT,
                null <span class="comment">/* listener */</span>, StatusKind.STATUS_MASK_NONE);
            <span class="keywordflow">if</span> (topic == null) {
                System.err.println(<span class="stringliteral">"create_topic error\n"</span>);
                <span class="keywordflow">return</span>;
            }                     
        
            <span class="comment">// --- Create reader --- //</span>

            listener = <span class="keyword">new</span> HelloWorldListener();

            <span class="comment">/* To customize data reader QoS, use</span>
<span class="comment">               subscriber.get_default_datareader_qos() */</span>
            reader = (HelloWorldDataReader)
                subscriber.create_datareader(
                    topic, Subscriber.DATAREADER_QOS_DEFAULT, listener,
                    StatusKind.STATUS_MASK_ALL);
            <span class="keywordflow">if</span> (reader == null) {
                System.err.println(<span class="stringliteral">"create_datareader error\n"</span>);
                <span class="keywordflow">return</span>;
            }                         
        
            <span class="comment">// --- Wait for data --- //</span>

            <span class="keyword">final</span> <span class="keywordtype">long</span> receivePeriodSec = 4;

            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> count = 0;
                 (sampleCount == 0) || (count &lt; sampleCount);
                 ++count) {
                System.out.println(<span class="stringliteral">"HelloWorld subscriber sleeping for "</span>
                                   + receivePeriodSec + <span class="stringliteral">" sec..."</span>);
                <span class="keywordflow">try</span> {
                    Thread.sleep(receivePeriodSec * 1000);  <span class="comment">// in millisec</span>
                } <span class="keywordflow">catch</span> (InterruptedException ix) {
                    System.err.println(<span class="stringliteral">"INTERRUPTED"</span>);
                    <span class="keywordflow">break</span>;
                }
            }
        } finally {

            <span class="comment">// --- Shutdown --- //</span>

            <span class="keywordflow">if</span>(participant != null) {
                participant.delete_contained_entities();

                DomainParticipantFactory.TheParticipantFactory.
                    delete_participant(participant);
            }
            <span class="comment">/* RTI Data Distribution Service provides finalize_instance()</span>
<span class="comment">               method for people who want to release memory used by the</span>
<span class="comment">               participant factory singleton. Uncomment the following block of</span>
<span class="comment">               code for clean destruction of the participant factory</span>
<span class="comment">               singleton. */</span>
            <span class="comment">//DomainParticipantFactory.finalize_instance();</span>
        }
    }
    
    <span class="comment">// -----------------------------------------------------------------------</span>
    <span class="comment">// Private Types</span>
    <span class="comment">// -----------------------------------------------------------------------</span>
    
    <span class="comment">// =======================================================================</span>
    
    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class </span>HelloWorldListener <span class="keyword">extends</span> DataReaderAdapter {
            
        HelloWorldSeq _dataSeq = <span class="keyword">new</span> HelloWorldSeq();
        SampleInfoSeq _infoSeq = <span class="keyword">new</span> SampleInfoSeq();

        <span class="keyword">public</span> <span class="keywordtype">void</span> on_data_available(DataReader reader) {
            HelloWorldDataReader HelloWorldReader =
                (HelloWorldDataReader)reader;
            
            <span class="keywordflow">try</span> {
                HelloWorldReader.take(
                    _dataSeq, _infoSeq,
                    ResourceLimitsQosPolicy.LENGTH_UNLIMITED,
                    SampleStateKind.ANY_SAMPLE_STATE,
                    ViewStateKind.ANY_VIEW_STATE,
                    InstanceStateKind.ANY_INSTANCE_STATE);

                <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; _dataSeq.size(); ++i) {
                    SampleInfo info = (SampleInfo)_infoSeq.get(i);

                    <span class="keywordflow">if</span> (info.valid_data) {
                        System.out.println(
                            ((HelloWorld)_dataSeq.get(i)).toString(<span class="stringliteral">"Received"</span>,0));


                    }
                }
            } <span class="keywordflow">catch</span> (RETCODE_NO_DATA noData) {
                <span class="comment">// No data to process</span>
            } finally {
                HelloWorldReader.return_loan(_dataSeq, _infoSeq);
            }
        }
    }
}

</pre></div> <HR>
<IMG SRC="rti_logo.gif" height="16">
<A HREF="main.html">RTI Data Distribution Service Java API Version 4.2e (General Access Release)</A>
Copyright &copy; 4 Dec 2007 
<A HREF="http://www.rti.com">Real-Time Innovations, Inc</A>
</BODY>
</HTML>
