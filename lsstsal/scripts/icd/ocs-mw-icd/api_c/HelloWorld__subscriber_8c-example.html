<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>RTI Data Distribution Service C API: HelloWorld_subscriber.c</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>HelloWorld_subscriber.c</h1><h2><a class="anchor" name="HelloWorldSubscription">
RTI Data Distribution Service Subscription Example</a></h2>
The unmodified subscription example generated by <a class="el" href="group__DDSNddsgenModule.html">rtiddsgen</a>.<h3><a class="anchor" name="HelloWorldSubscription_src">
HelloWorld_subscriber.c</a></h3>
[$(NDDSHOME)/example/C/helloWorld/HelloWorld_subscriber.c]<p>
<div class="fragment"><pre class="fragment"><span class="comment">/* HelloWorld_subscriber.c</span>
<span class="comment"></span>
<span class="comment">   A subscription example</span>
<span class="comment"></span>
<span class="comment">   This file is derived from code automatically generated by the rtiddsgen </span>
<span class="comment">   command:</span>
<span class="comment"></span>
<span class="comment">   rtiddsgen -language C -example &lt;arch&gt; HelloWorld.idl</span>
<span class="comment"></span>
<span class="comment">   Example subscription of type HelloWorld automatically generated by </span>
<span class="comment">   'rtiddsgen'. To test them follow these steps:</span>
<span class="comment"></span>
<span class="comment">   (1) Compile this file and the example publication.</span>
<span class="comment"></span>
<span class="comment">   (2) Start the subscription on the same domain used for RTI Data Distribution</span>
<span class="comment">       Service  with the command</span>
<span class="comment">       objs/&lt;arch&gt;/HelloWorld_subscriber &lt;domain_id&gt; &lt;sample_count&gt;</span>
<span class="comment"></span>
<span class="comment">   (3) Start the publication on the same domain used for RTI Data Distribution</span>
<span class="comment">       Service with the command</span>
<span class="comment">       objs/&lt;arch&gt;/HelloWorld_publisher &lt;domain_id&gt; &lt;sample_count&gt;</span>
<span class="comment"></span>
<span class="comment">   (4) [Optional] Specify the list of discovery initial peers and </span>
<span class="comment">       multicast receive addresses via an environment variable or a file </span>
<span class="comment">       (in the current working directory) called NDDS_DISCOVERY_PEERS. </span>
<span class="comment">       </span>
<span class="comment">   You can run any number of publishers and subscribers programs, and can </span>
<span class="comment">   add and remove them dynamically from the domain.</span>
<span class="comment">              </span>
<span class="comment">                                   </span>
<span class="comment">   Example:</span>
<span class="comment">        </span>
<span class="comment">       To run the example application on domain &lt;domain_id&gt;:</span>
<span class="comment">                          </span>
<span class="comment">       On Unix: </span>
<span class="comment">       </span>
<span class="comment">       objs/&lt;arch&gt;/HelloWorld_publisher &lt;domain_id&gt; </span>
<span class="comment">       objs/&lt;arch&gt;/HelloWorld_subscriber &lt;domain_id&gt; </span>
<span class="comment">                            </span>
<span class="comment">       On Windows:</span>
<span class="comment">       </span>
<span class="comment">       objs&lt;arch&gt;\HelloWorld_publisher &lt;domain_id&gt;  </span>
<span class="comment">       objs&lt;arch&gt;\HelloWorld_subscriber &lt;domain_id&gt;   </span>
<span class="comment">       </span>
<span class="comment">       </span>
<span class="comment">modification history</span>
<span class="comment">------------ -------       </span>
<span class="comment">*/</span>

<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include "ndds/ndds_c.h"</span>
<span class="preprocessor">#include "HelloWorld.h"</span>
<span class="preprocessor">#include "HelloWorldSupport.h"</span>

<span class="keywordtype">void</span> HelloWorldListener_on_requested_deadline_missed(
    <span class="keywordtype">void</span>* listener_data,
    <a name="a29"></a><a class="code" href="group__DDSReaderModule.html#ga0">DDS_DataReader</a>* reader,
    <span class="keyword">const</span> <span class="keyword">struct</span> <a name="_a30"></a><a class="code" href="structDDS__RequestedDeadlineMissedStatus.html">DDS_RequestedDeadlineMissedStatus</a> *status)
{
}

<span class="keywordtype">void</span> HelloWorldListener_on_requested_incompatible_qos(
    <span class="keywordtype">void</span>* listener_data,
    <a class="code" href="group__DDSReaderModule.html#ga0">DDS_DataReader</a>* reader,
    <span class="keyword">const</span> <span class="keyword">struct</span> <a name="_a31"></a><a class="code" href="structDDS__RequestedIncompatibleQosStatus.html">DDS_RequestedIncompatibleQosStatus</a> *status)
{
}

<span class="keywordtype">void</span> HelloWorldListener_on_sample_rejected(
    <span class="keywordtype">void</span>* listener_data,
    <a class="code" href="group__DDSReaderModule.html#ga0">DDS_DataReader</a>* reader,
    <span class="keyword">const</span> <span class="keyword">struct</span> <a name="_a32"></a><a class="code" href="structDDS__SampleRejectedStatus.html">DDS_SampleRejectedStatus</a> *status)
{
}

<span class="keywordtype">void</span> HelloWorldListener_on_liveliness_changed(
    <span class="keywordtype">void</span>* listener_data,
    <a class="code" href="group__DDSReaderModule.html#ga0">DDS_DataReader</a>* reader,
    <span class="keyword">const</span> <span class="keyword">struct</span> <a name="_a33"></a><a class="code" href="structDDS__LivelinessChangedStatus.html">DDS_LivelinessChangedStatus</a> *status)
{
}

<span class="keywordtype">void</span> HelloWorldListener_on_sample_lost(
    <span class="keywordtype">void</span>* listener_data,
    <a class="code" href="group__DDSReaderModule.html#ga0">DDS_DataReader</a>* reader,
    <span class="keyword">const</span> <span class="keyword">struct</span> <a name="_a34"></a><a class="code" href="structDDS__SampleLostStatus.html">DDS_SampleLostStatus</a> *status)
{
}

<span class="keywordtype">void</span> HelloWorldListener_on_subscription_matched(
    <span class="keywordtype">void</span>* listener_data,
    <a class="code" href="group__DDSReaderModule.html#ga0">DDS_DataReader</a>* reader,
    <span class="keyword">const</span> <span class="keyword">struct</span> <a name="_a35"></a><a class="code" href="structDDS__SubscriptionMatchedStatus.html">DDS_SubscriptionMatchedStatus</a> *status)
{
}

<span class="keywordtype">void</span> HelloWorldListener_on_data_available(
    <span class="keywordtype">void</span>* listener_data,
    <a class="code" href="group__DDSReaderModule.html#ga0">DDS_DataReader</a>* reader)
{
    HelloWorldDataReader *HelloWorld_reader = NULL;
    <span class="keyword">struct </span>HelloWorldSeq data_seq = <a name="a36"></a><a class="code" href="group__DDSSequenceModule.html#ga17">DDS_SEQUENCE_INITIALIZER</a>;
    <span class="keyword">struct </span><a name="_a37"></a><a class="code" href="structDDS__SampleInfoSeq.html">DDS_SampleInfoSeq</a> info_seq = <a class="code" href="group__DDSSequenceModule.html#ga17">DDS_SEQUENCE_INITIALIZER</a>;
    <a name="a38"></a><a class="code" href="group__DDSReturnTypesModule.html#ga13">DDS_ReturnCode_t</a> retcode;
    <span class="keywordtype">int</span> i;

    HelloWorld_reader = HelloWorldDataReader_narrow(reader);
    <span class="keywordflow">if</span> (HelloWorld_reader == NULL) {
        printf(<span class="stringliteral">"DataReader narrow error\n"</span>);
        <span class="keywordflow">return</span>;
    }

    retcode = HelloWorldDataReader_take(
        HelloWorld_reader,
        &amp;data_seq, &amp;info_seq, <a name="a39"></a><a class="code" href="group__DDSResourceLimitsQosModule.html#ga1">DDS_LENGTH_UNLIMITED</a>,
        <a name="a40"></a><a class="code" href="group__DDSSampleStateModule.html#ga1">DDS_ANY_SAMPLE_STATE</a>, <a name="a41"></a><a class="code" href="group__DDSViewStateModule.html#ga1">DDS_ANY_VIEW_STATE</a>, <a name="a42"></a><a class="code" href="group__DDSInstanceStateModule.html#ga1">DDS_ANY_INSTANCE_STATE</a>);
    <span class="keywordflow">if</span> (retcode == <a name="a43"></a><a class="code" href="group__DDSReturnTypesModule.html#gga13a11">DDS_RETCODE_NO_DATA</a>) {
        <span class="keywordflow">return</span>;
    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (retcode != <a name="a44"></a><a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
        printf(<span class="stringliteral">"take error %d\n"</span>, retcode);
        <span class="keywordflow">return</span>;
    }

    <span class="keywordflow">for</span> (i = 0; i &lt; HelloWorldSeq_get_length(&amp;data_seq); ++i) {
        <span class="keywordflow">if</span> (DDS_SampleInfoSeq_get_reference(&amp;info_seq, i)-&gt;valid_data) {
            HelloWorldTypeSupport_print_data(
                HelloWorldSeq_get_reference(&amp;data_seq, i));
        }
    }

    retcode = HelloWorldDataReader_return_loan(
        HelloWorld_reader,
        &amp;data_seq, &amp;info_seq);
    <span class="keywordflow">if</span> (retcode != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
        printf(<span class="stringliteral">"return loan error %d\n"</span>, retcode);
    }
}

<span class="comment">/* Delete all entities */</span>
<span class="keyword">static</span> <span class="keywordtype">int</span> subscriber_shutdown(
    <a name="a45"></a><a class="code" href="group__DDSDomainParticipantModule.html#ga4">DDS_DomainParticipant</a> *participant)
{
    <a class="code" href="group__DDSReturnTypesModule.html#ga13">DDS_ReturnCode_t</a> retcode;
    <span class="keywordtype">int</span> status = 0;

    <span class="keywordflow">if</span> (participant != NULL) {
        retcode = <a name="a46"></a><a class="code" href="group__DDSDomainParticipantModule.html#ga46">DDS_DomainParticipant_delete_contained_entities</a>(participant);
        <span class="keywordflow">if</span> (retcode != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
            printf(<span class="stringliteral">"delete_contained_entities error %d\n"</span>, retcode);
            status = -1;
        }

        retcode = <a name="a47"></a><a class="code" href="group__DDSDomainParticipantFactoryModule.html#ga10">DDS_DomainParticipantFactory_delete_participant</a>(
            <a name="a48"></a><a class="code" href="group__DDSDomainModule.html#ga1">DDS_TheParticipantFactory</a>, participant);
        <span class="keywordflow">if</span> (retcode != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
            printf(<span class="stringliteral">"delete_participant error %d\n"</span>, retcode);
            status = -1;
        }
    }

    <span class="comment">/* RTI Data Distribution Service provides finalize_instance() method on</span>
<span class="comment">       domain participant factory and finalize() method on type support for</span>
<span class="comment">       people who want to release memory used by the participant factory and</span>
<span class="comment">       type support singletons. Uncomment the following block of code for</span>
<span class="comment">       clean destruction of the singletons. */</span>
<span class="comment">/*</span>
<span class="comment">    HelloWorldTypeSupport_finalize();</span>
<span class="comment"></span>
<span class="comment">    retcode = DDS_DomainParticipantFactory_finalize_instance();</span>
<span class="comment">    if (retcode != DDS_RETCODE_OK) {</span>
<span class="comment">        printf("finalize_instance error %d\n", retcode);</span>
<span class="comment">        status = -1;</span>
<span class="comment">    }</span>
<span class="comment">*/</span>

    <span class="keywordflow">return</span> status;
}

<span class="keyword">static</span> <span class="keywordtype">int</span> subscriber_main(<span class="keywordtype">int</span> domainId, <span class="keywordtype">int</span> sample_count)
{
    <a class="code" href="group__DDSDomainParticipantModule.html#ga4">DDS_DomainParticipant</a> *participant = NULL;
    <a name="a49"></a><a class="code" href="group__DDSSubscriberModule.html#ga0">DDS_Subscriber</a> *subscriber = NULL;
    <a class="code" href="group__DDSTopicEntityModule.html#ga1">DDS_Topic</a> *topic = NULL;
    <span class="keyword">struct </span><a name="_a50"></a><a class="code" href="structDDS__DataReaderListener.html">DDS_DataReaderListener</a> reader_listener =
        <a name="a51"></a><a class="code" href="group__DDSReaderModule.html#ga74">DDS_DataReaderListener_INITIALIZER</a>;
    <a class="code" href="group__DDSReaderModule.html#ga0">DDS_DataReader</a> *reader = NULL;
    <a class="code" href="group__DDSReturnTypesModule.html#ga13">DDS_ReturnCode_t</a> retcode;
    <span class="keyword">const</span> <span class="keywordtype">char</span> *type_name = NULL;
    <span class="keywordtype">int</span> count = 0;
    <span class="keyword">struct </span><a name="_a52"></a><a class="code" href="structDDS__Duration__t.html">DDS_Duration_t</a> poll_period = {4,0};


    <span class="comment">/* To customize participant QoS, use </span>
<span class="comment">       DDS_DomainParticipantFactory_get_default_participant_qos() */</span>
    participant = <a name="a53"></a><a class="code" href="group__DDSDomainParticipantFactoryModule.html#ga9">DDS_DomainParticipantFactory_create_participant</a>(
        <a class="code" href="group__DDSDomainModule.html#ga1">DDS_TheParticipantFactory</a>, domainId, &amp;<a name="a54"></a><a class="code" href="group__DDSDomainParticipantFactoryModule.html#ga0">DDS_PARTICIPANT_QOS_DEFAULT</a>,
        NULL <span class="comment">/* listener */</span>, <a name="a55"></a><a class="code" href="group__DDSStatusTypesModule.html#ga1">DDS_STATUS_MASK_NONE</a>);
    <span class="keywordflow">if</span> (participant == NULL) {
        printf(<span class="stringliteral">"create_participant error\n"</span>);
        subscriber_shutdown(participant);
        <span class="keywordflow">return</span> -1;
    }

    <span class="comment">/* To customize subscriber QoS, use</span>
<span class="comment">       DDS_DomainParticipant_get_default_subscriber_qos() */</span>
    subscriber = <a name="a56"></a><a class="code" href="group__DDSDomainParticipantModule.html#ga23">DDS_DomainParticipant_create_subscriber</a>(
        participant, &amp;<a name="a57"></a><a class="code" href="group__DDSDomainParticipantModule.html#ga2">DDS_SUBSCRIBER_QOS_DEFAULT</a>, NULL <span class="comment">/* listener */</span>,
        <a class="code" href="group__DDSStatusTypesModule.html#ga1">DDS_STATUS_MASK_NONE</a>);
    <span class="keywordflow">if</span> (subscriber == NULL) {
        printf(<span class="stringliteral">"create_subscriber error\n"</span>);
        subscriber_shutdown(participant);
        <span class="keywordflow">return</span> -1;
    }

    <span class="comment">/* Register type before creating topic */</span>
    type_name = HelloWorldTypeSupport_get_type_name();
    retcode = HelloWorldTypeSupport_register_type(participant, type_name);
    <span class="keywordflow">if</span> (retcode != <a class="code" href="group__DDSReturnTypesModule.html#gga13a0">DDS_RETCODE_OK</a>) {
        printf(<span class="stringliteral">"register_type error %d\n"</span>, retcode);
        subscriber_shutdown(participant);
        <span class="keywordflow">return</span> -1;
    }

    <span class="comment">/* To customize topic QoS, use</span>
<span class="comment">       DDS_DomainParticipant_get_default_topic_qos() */</span>
    topic = <a name="a58"></a><a class="code" href="group__DDSDomainParticipantModule.html#ga25">DDS_DomainParticipant_create_topic</a>(
        participant, <span class="stringliteral">"Example HelloWorld"</span>,
        type_name, &amp;<a name="a59"></a><a class="code" href="group__DDSDomainParticipantModule.html#ga0">DDS_TOPIC_QOS_DEFAULT</a>, NULL <span class="comment">/* listener */</span>,
        <a class="code" href="group__DDSStatusTypesModule.html#ga1">DDS_STATUS_MASK_NONE</a>);
    <span class="keywordflow">if</span> (topic == NULL) {
        printf(<span class="stringliteral">"create_topic error\n"</span>);
        subscriber_shutdown(participant);
        <span class="keywordflow">return</span> -1;
    }

    <span class="comment">/* Setup data reader listener */</span>
    reader_listener.<a name="a60"></a><a class="code" href="structDDS__DataReaderListener.html#o1">on_requested_deadline_missed</a>  =
        HelloWorldListener_on_requested_deadline_missed;
    reader_listener.<a name="a61"></a><a class="code" href="structDDS__DataReaderListener.html#o2">on_requested_incompatible_qos</a> =
        HelloWorldListener_on_requested_incompatible_qos;
    reader_listener.<a name="a62"></a><a class="code" href="structDDS__DataReaderListener.html#o3">on_sample_rejected</a> =
        HelloWorldListener_on_sample_rejected;
    reader_listener.<a name="a63"></a><a class="code" href="structDDS__DataReaderListener.html#o4">on_liveliness_changed</a> =
        HelloWorldListener_on_liveliness_changed;
    reader_listener.<a name="a64"></a><a class="code" href="structDDS__DataReaderListener.html#o7">on_sample_lost</a> =
        HelloWorldListener_on_sample_lost;
    reader_listener.<a name="a65"></a><a class="code" href="structDDS__DataReaderListener.html#o6">on_subscription_matched</a> =
        HelloWorldListener_on_subscription_matched;
    reader_listener.<a name="a66"></a><a class="code" href="structDDS__DataReaderListener.html#o5">on_data_available</a> =
        HelloWorldListener_on_data_available;

    <span class="comment">/* To customize data reader QoS, use</span>
<span class="comment">       DDS_Subscriber_get_default_datareader_qos() */</span>
    reader = <a name="a67"></a><a class="code" href="group__DDSSubscriberModule.html#ga10">DDS_Subscriber_create_datareader</a>(
        subscriber, <a name="a68"></a><a class="code" href="group__DDSTopicEntityModule.html#ga18">DDS_Topic_as_topicdescription</a>(topic),
        &amp;<a name="a69"></a><a class="code" href="group__DDSSubscriberModule.html#ga2">DDS_DATAREADER_QOS_DEFAULT</a>, &amp;reader_listener, <a name="a70"></a><a class="code" href="group__DDSStatusTypesModule.html#ga2">DDS_STATUS_MASK_ALL</a>);
    <span class="keywordflow">if</span> (reader == NULL) {
        printf(<span class="stringliteral">"create_datareader error\n"</span>);
        subscriber_shutdown(participant);
        <span class="keywordflow">return</span> -1;
    }

    <span class="comment">/* Main loop */</span>
    <span class="keywordflow">for</span> (count=0; (sample_count == 0) || (count &lt; sample_count); ++count) {
        printf(<span class="stringliteral">"HelloWorld subscriber sleeping for %d sec...\n"</span>,
               poll_period.<a name="a71"></a><a class="code" href="structDDS__Duration__t.html#o0">sec</a>);
        <a name="a72"></a><a class="code" href="group__NDDSUtilityModule.html#ga0">NDDS_Utility_sleep</a>(&amp;poll_period);
    }

    <span class="comment">/* Cleanup and delete delete all entities */</span> 
    <span class="keywordflow">return</span> subscriber_shutdown(participant);
}

<span class="preprocessor">#if defined(RTI_WINCE)</span>
<span class="preprocessor"></span><span class="keywordtype">int</span> wmain(<span class="keywordtype">int</span> argc, <span class="keywordtype">wchar_t</span>** argv)
{
    <span class="keywordtype">int</span> domainId = 0;
    <span class="keywordtype">int</span> sample_count = 0; <span class="comment">/* infinite loop */</span>
    
    <span class="keywordflow">if</span> (argc &gt;= 2) {
        domainId = _wtoi(argv[1]);
    }
    <span class="keywordflow">if</span> (argc &gt;= 3) {
        sample_count = _wtoi(argv[2]);
    }

    <span class="comment">/* Uncomment this to turn on additional logging</span>
<span class="comment">    NDDS_Config_Logger_set_verbosity_by_category(</span>
<span class="comment">        NDDS_Config_Logger_get_instance(),</span>
<span class="comment">        NDDS_CONFIG_LOG_CATEGORY_API, </span>
<span class="comment">        NDDS_CONFIG_LOG_VERBOSITY_STATUS_ALL);</span>
<span class="comment">    */</span>
    
    <span class="keywordflow">return</span> subscriber_main(domainId, sample_count);
}
<span class="preprocessor">#elif !(defined(RTI_VXWORKS) &amp;&amp; !defined(__RTP__)) &amp;&amp; !defined(RTI_PSOS)</span>
<span class="preprocessor"></span><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])
{
    <span class="keywordtype">int</span> domainId = 0;
    <span class="keywordtype">int</span> sample_count = 0; <span class="comment">/* infinite loop */</span>

    <span class="keywordflow">if</span> (argc &gt;= 2) {
        domainId = atoi(argv[1]);
    }
    <span class="keywordflow">if</span> (argc &gt;= 3) {
        sample_count = atoi(argv[2]);
    }

    <span class="comment">/* Uncomment this to turn on additional logging</span>
<span class="comment">    NDDS_Config_Logger_set_verbosity_by_category(</span>
<span class="comment">        NDDS_Config_Logger_get_instance(),</span>
<span class="comment">        NDDS_CONFIG_LOG_CATEGORY_API, </span>
<span class="comment">        NDDS_CONFIG_LOG_VERBOSITY_STATUS_ALL);</span>
<span class="comment">    */</span>
    
    <span class="keywordflow">return</span> subscriber_main(domainId, sample_count);
}
<span class="preprocessor">#endif</span>
</pre></div> <HR>
<IMG SRC="rti_logo.gif" height="16">
<A HREF="main.html">RTI Data Distribution Service C API Version 4.2e (General Access Release)</A>
Copyright &copy; 4 Dec 2007 
<A HREF="http://www.rti.com">Real-Time Innovations, Inc</A>
</BODY>
</HTML>
